{"ast":null,"code":"import _classCallCheck from \"/Users/chenjiayuan/junior_design/talli/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/chenjiayuan/junior_design/talli/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/chenjiayuan/junior_design/talli/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/chenjiayuan/junior_design/talli/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/chenjiayuan/junior_design/talli/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/chenjiayuan/junior_design/talli/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/Users/chenjiayuan/junior_design/talli/client/src/components/VoterView/RankingContainer.js\";\nimport React, { Component } from 'react';\nimport { SortableContainer, SortableElement, SortableHandle, arrayMove } from 'react-sortable-hoc';\nimport SliderIcon from '@material-ui/icons/Sort';\nimport AddCircleIcon from '@material-ui/icons/AddCircle';\nimport { Typography, Button } from '@material-ui/core';\nimport BellIcon from '@material-ui/icons/NotificationImportant';\nimport openSocket from 'socket.io-client';\nimport firebase from '../../firebase';\nimport { getCookie } from '../../cookies';\nimport SubmitConfirm from './Dialogs/SubmitConfirm';\nimport Countdown from './Countdown';\nimport EventClosed from './Dialogs/EventClosed';\nimport '../component_style/RankingContainer.css';\n\nvar config = require('../../config.json');\n\nvar socket = openSocket(config.Global.devMode ? \"http://localhost:\".concat(config.Global.serverPort) : \"\".concat(config.Global.sslEnabled ? \"https\" : \"http\", \"://\").concat(config.Global.hostURL));\nvar DragHandle = SortableHandle(function () {\n  return React.createElement(\"span\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 23\n    },\n    __self: this\n  }, React.createElement(SliderIcon, {\n    className: \"Sliders\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 23\n    },\n    __self: this\n  }));\n});\n\nvar SortContainer =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(SortContainer, _Component);\n\n  function SortContainer(props) {\n    var _this;\n\n    _classCallCheck(this, SortContainer);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(SortContainer).call(this, props));\n\n    _this.onSortEnd = function (_ref) {\n      var oldIndex = _ref.oldIndex,\n          newIndex = _ref.newIndex;\n\n      _this.setState({\n        items: arrayMove(_this.state.items, oldIndex, newIndex)\n      });\n\n      _this.updateDatabaseRankings(_this.state.items);\n    };\n\n    _this.toggleShowInfo = function (item) {\n      var oldItems = _this.state.items;\n      oldItems[item].showInfo = !oldItems[item].showInfo;\n\n      _this.setState({\n        items: oldItems\n      });\n    };\n\n    _this.state = {\n      items: [],\n      event: {\n        id: '',\n        name: '',\n        location: '',\n        startDate: '',\n        endDate: '',\n        automate: false,\n        startVote: '',\n        endVote: '',\n        entries: []\n      }\n    };\n    _this.handleAddEvent = _this.handleAddEvent.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.submitConfirm = _this.submitConfirm.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.submitted = _this.submitted.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.countdownFinished = _this.countdownFinished.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.confirmChild = React.createRef();\n    _this.closedChild = React.createRef();\n    return _this;\n  }\n\n  _createClass(SortContainer, [{\n    key: \"handleAddEvent\",\n    value: function handleAddEvent(e) {\n      e.preventDefault();\n      this.props.updateItemsHandler(this.state.items);\n      this.props.handler(this.props.voteViews.ADD);\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.setState({\n        items: this.props.rankItems\n      }, function () {\n        firebase.database().ref(\"/organizer/\".concat(_this2.props.organizer, \"/event/\")).once('value').then(function (snapshot) {\n          var events = snapshot.val();\n\n          if (!events || !events[_this2.props.eventID]) {\n            // Error\n            console.log('DEV ERROR');\n          }\n\n          var eventBase = events[_this2.props.eventID].eventData;\n          var eventEntries = events[_this2.props.eventID].entries;\n          var itemList = _this2.state.items;\n\n          if (eventEntries && _this2.props.entryToAdd && !_this2.state.items.some(function (e) {\n            return e.id === _this2.props.entryToAdd;\n          })) {\n            var entryId = _this2.props.entryToAdd;\n            itemList.push({\n              name: eventEntries[entryId].title,\n              id: entryId,\n              presenters: eventEntries[entryId].presenters,\n              entry_dates: eventEntries[entryId].entry_dates,\n              info_url: eventEntries[entryId].info_url,\n              showInfo: false\n            });\n\n            _this2.updateDatabaseRankings(itemList);\n          }\n\n          _this2.setState({\n            event: {\n              id: eventBase.id,\n              name: eventBase.name,\n              location: eventBase.location,\n              startDate: eventBase.startDate,\n              endDate: eventBase.endDate,\n              automate: eventBase.automate,\n              startVote: eventBase.startVote,\n              endVote: eventBase.endVote,\n              entries: eventEntries\n            },\n            items: itemList\n          }, function () {\n            _this2.props.updateItemsHandler(_this2.state.items);\n          });\n        });\n      });\n    }\n  }, {\n    key: \"updateDatabaseRankings\",\n    value: function updateDatabaseRankings(items) {\n      var cookie = getCookie('UserID');\n      var ref = firebase.database().ref(\"event/\".concat(this.props.eventID, \"/attendees/\").concat(cookie, \"/rankings/\"));\n\n      for (var i = 0; i < items.length; i++) {\n        ref.child(i + 1).set(items[i]);\n      }\n    }\n  }, {\n    key: \"submitConfirm\",\n    value: function submitConfirm() {\n      this.props.updateItemsHandler(this.state.items);\n      this.confirmChild.current.handleOpen();\n    }\n  }, {\n    key: \"submitted\",\n    value: function submitted() {\n      var items = this.state.items;\n      var organizerId = this.props.organizer;\n      var eventId = this.state.event.id;\n      var cookie = getCookie('UserID');\n      firebase.database().ref(\"event/\".concat(eventId, \"/attendees/\").concat(cookie)).child('submitted').set(true);\n      socket.emit('send_votes', {\n        eventId: eventId,\n        organizerId: organizerId,\n        votes: items\n      });\n      this.props.handler(this.props.voteViews.SUBMITTED);\n    }\n  }, {\n    key: \"countdownFinished\",\n    value: function countdownFinished() {\n      var cookie = getCookie('UserID');\n      var itemsRef = firebase.database().ref(\"attendees/\".concat(cookie));\n      itemsRef.child('currentEvent').set('');\n      itemsRef.child(\"pastEvents/\".concat(this.props.eventID, \"/\")).set(this.props.eventID);\n      this.closedChild.current.handleOpen();\n    }\n  }, {\n    key: \"isValidURL\",\n    value: function isValidURL(str) {\n      var a = document.createElement('a');\n      a.href = str;\n      return a.host && a.host !== window.location.host;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var SortableItem = SortableElement(function (_ref2) {\n        var value = _ref2.value,\n            item = _ref2.item;\n        return React.createElement(\"li\", {\n          className: \"rankings\",\n          onClick: function onClick() {\n            return _this3.toggleShowInfo(item);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 160\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          id: \"rankNumber\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 161\n          },\n          __self: this\n        }, item + 1), React.createElement(\"div\", {\n          id: \"rankTitle\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 162\n          },\n          __self: this\n        }, value.name, value.showInfo ? React.createElement(\"div\", {\n          id: \"expandedInfo\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 167\n          },\n          __self: this\n        }, React.createElement(\"b\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 168\n          },\n          __self: this\n        }, \"By:\"), \" \", value.presenters, \" \", React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 168\n          },\n          __self: this\n        }), React.createElement(\"b\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 169\n          },\n          __self: this\n        }, \"Attendance:\"), \" \", value.entry_dates, \" \", React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 169\n          },\n          __self: this\n        }), value.info_url && React.createElement(React.Fragment, null, React.createElement(\"b\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 172\n          },\n          __self: this\n        }, \"Info URL: \"), _this3.isValidURL(value.info_url) ? React.createElement(\"a\", {\n          href: value.info_url,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 174\n          },\n          __self: this\n        }, value.info_url) : value.info_url)) : ''), React.createElement(DragHandle, {\n          id: \"rankHandle\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 182\n          },\n          __self: this\n        }));\n      });\n      var SortableList = SortableContainer(function (_ref3) {\n        var items = _ref3.items;\n        return React.createElement(\"ul\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 188\n          },\n          __self: this\n        }, items.length !== 0 ? React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 189\n          },\n          __self: this\n        }) : React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 189\n          },\n          __self: this\n        }, \"Tap the Plus to add an entry\"), items.map(function (value, index) {\n          return React.createElement(SortableItem, {\n            key: value.id,\n            item: index,\n            index: index,\n            value: value,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 191\n            },\n            __self: this\n          });\n        }));\n      });\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 203\n        },\n        __self: this\n      }, React.createElement(EventClosed, {\n        handler: this.submitted,\n        ref: this.closedChild,\n        eventName: this.state.event.name,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 204\n        },\n        __self: this\n      }), React.createElement(SubmitConfirm, {\n        handler: this.submitted,\n        ref: this.confirmChild,\n        items: this.state.items,\n        eventID: this.state.event.id,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 205\n        },\n        __self: this\n      }), React.createElement(Typography, {\n        variant: \"h4\",\n        align: \"center\",\n        className: \"eventName\",\n        gutterBottom: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 206\n        },\n        __self: this\n      }, this.state.event.name), React.createElement(\"div\", {\n        style: {\n          textAlign: 'center'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207\n        },\n        __self: this\n      }, React.createElement(AddCircleIcon, {\n        className: \"AddEvent\",\n        id: \"addEntry\",\n        color: \"secondary\",\n        onClick: this.handleAddEvent,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 208\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"SortContainer\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 211\n        },\n        __self: this\n      }, React.createElement(SortableList, {\n        items: this.state.items,\n        onSortEnd: this.onSortEnd,\n        lockAxis: \"y\",\n        useDragHandle: true,\n        helperClass: \"sortHelp\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 212\n        },\n        __self: this\n      }))), this.state.event.endVote !== 'none' ? React.createElement(\"div\", {\n        className: \"SubmitDiv\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 223\n        },\n        __self: this\n      }, React.createElement(BellIcon, {\n        className: \"BellIcon\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"SubmitText\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225\n        },\n        __self: this\n      }, \"Voting will close in:\", React.createElement(Countdown, {\n        date: this.state.event.endVote,\n        onFinished: this.countdownFinished,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"buttonDiv\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 229\n        },\n        __self: this\n      }, React.createElement(Button, {\n        variant: \"contained\",\n        color: \"primary\",\n        onClick: this.submitConfirm,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 230\n        },\n        __self: this\n      }, \" Submit \"))) : React.createElement(\"div\", {\n        className: \"CenterSubmitDiv\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"CenterButtonDiv\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 235\n        },\n        __self: this\n      }, React.createElement(Button, {\n        variant: \"contained\",\n        color: \"primary\",\n        onClick: this.submitConfirm,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 236\n        },\n        __self: this\n      }, \" Submit \"))));\n    }\n  }]);\n\n  return SortContainer;\n}(Component);\n\nexport { SortContainer as default };","map":{"version":3,"sources":["/Users/chenjiayuan/junior_design/talli/client/src/components/VoterView/RankingContainer.js"],"names":["React","Component","SortableContainer","SortableElement","SortableHandle","arrayMove","SliderIcon","AddCircleIcon","Typography","Button","BellIcon","openSocket","firebase","getCookie","SubmitConfirm","Countdown","EventClosed","config","require","socket","Global","devMode","serverPort","sslEnabled","hostURL","DragHandle","SortContainer","props","onSortEnd","oldIndex","newIndex","setState","items","state","updateDatabaseRankings","toggleShowInfo","item","oldItems","showInfo","event","id","name","location","startDate","endDate","automate","startVote","endVote","entries","handleAddEvent","bind","submitConfirm","submitted","countdownFinished","confirmChild","createRef","closedChild","e","preventDefault","updateItemsHandler","handler","voteViews","ADD","rankItems","database","ref","organizer","once","then","snapshot","events","val","eventID","console","log","eventBase","eventData","eventEntries","itemList","entryToAdd","some","entryId","push","title","presenters","entry_dates","info_url","cookie","i","length","child","set","current","handleOpen","organizerId","eventId","emit","votes","SUBMITTED","itemsRef","str","a","document","createElement","href","host","window","SortableItem","value","isValidURL","SortableList","map","index","textAlign"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { SortableContainer, SortableElement, SortableHandle, arrayMove } from 'react-sortable-hoc';\nimport SliderIcon from '@material-ui/icons/Sort';\nimport AddCircleIcon from '@material-ui/icons/AddCircle';\nimport { Typography, Button } from '@material-ui/core';\nimport BellIcon from '@material-ui/icons/NotificationImportant';\nimport openSocket from 'socket.io-client';\nimport firebase from '../../firebase';\nimport { getCookie } from '../../cookies';\nimport SubmitConfirm from './Dialogs/SubmitConfirm';\nimport Countdown from './Countdown';\nimport EventClosed from './Dialogs/EventClosed';\nimport '../component_style/RankingContainer.css';\n\nconst config = require('../../config.json');\n\nconst socket = openSocket(\n    (config.Global.devMode ?\n        `http://localhost:${config.Global.serverPort}` :\n        `${(config.Global.sslEnabled ? \"https\" : \"http\")}://${config.Global.hostURL}`\n    )\n);\nconst DragHandle = SortableHandle(() => <span><SliderIcon className=\"Sliders\" /></span>);\n\nexport default class SortContainer extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            items: [],\n            event: {\n                id: '',\n                name: '',\n                location: '',\n                startDate: '',\n                endDate: '',\n                automate: false,\n                startVote: '',\n                endVote: '',\n                entries: []\n            },\n        };\n        this.handleAddEvent = this.handleAddEvent.bind(this);\n        this.submitConfirm = this.submitConfirm.bind(this);\n        this.submitted = this.submitted.bind(this);\n        this.countdownFinished = this.countdownFinished.bind(this);\n\n        this.confirmChild = React.createRef();\n        this.closedChild = React.createRef();\n    }\n\n    handleAddEvent(e) {\n        e.preventDefault();\n        this.props.updateItemsHandler(this.state.items);\n        this.props.handler(this.props.voteViews.ADD);\n    }\n\n    componentDidMount() {\n        this.setState({\n            items: this.props.rankItems,\n        }, () => {\n            firebase.database().ref(`/organizer/${this.props.organizer}/event/`).once('value').then(snapshot => {\n                const events = snapshot.val();\n                if (!events || !events[this.props.eventID]) {\n                    // Error\n                    console.log('DEV ERROR');\n                }\n                const eventBase = events[this.props.eventID].eventData;\n                const eventEntries = events[this.props.eventID].entries;\n                const itemList = this.state.items;\n                if (eventEntries && this.props.entryToAdd && !this.state.items.some(e => e.id === this.props.entryToAdd)) {\n                    const entryId = this.props.entryToAdd;\n                    itemList.push({\n                        name: eventEntries[entryId].title,\n                        id: entryId,\n                        presenters: eventEntries[entryId].presenters,\n                        entry_dates: eventEntries[entryId].entry_dates,\n                        info_url: eventEntries[entryId].info_url,\n                        showInfo: false,\n                    });\n                    this.updateDatabaseRankings(itemList);\n                }\n                this.setState({\n                    event: {\n                        id: eventBase.id,\n                        name: eventBase.name,\n                        location: eventBase.location,\n                        startDate: eventBase.startDate,\n                        endDate: eventBase.endDate,\n                        automate: eventBase.automate,\n                        startVote: eventBase.startVote,\n                        endVote: eventBase.endVote,\n                        entries: eventEntries\n                    },\n                    items: itemList,\n                }, () => {\n                    this.props.updateItemsHandler(this.state.items);\n                });\n            });\n        });\n    }\n\n    onSortEnd = ({ oldIndex, newIndex }) => {\n        this.setState({\n            items: arrayMove(this.state.items, oldIndex, newIndex),\n        });\n        this.updateDatabaseRankings(this.state.items);\n    };\n\n    updateDatabaseRankings(items) {\n        const cookie = getCookie('UserID');\n        const ref = firebase.database().ref(`event/${this.props.eventID}/attendees/${cookie}/rankings/`);\n        for (let i = 0; i < items.length; i++) {\n            ref.child(i + 1).set(items[i]);\n        }\n    }\n\n    submitConfirm() {\n        this.props.updateItemsHandler(this.state.items);\n        this.confirmChild.current.handleOpen();\n    }\n\n    submitted() {\n        const items = this.state.items;\n        const organizerId = this.props.organizer;\n        const eventId = this.state.event.id;\n        const cookie = getCookie('UserID');\n        firebase.database().ref(`event/${eventId}/attendees/${cookie}`).child('submitted').set(true);\n        socket.emit('send_votes', {\n            eventId,\n            organizerId,\n            votes: items\n        });\n        this.props.handler(this.props.voteViews.SUBMITTED);\n    }\n\n    countdownFinished() {\n        const cookie = getCookie('UserID');\n        const itemsRef = firebase.database().ref(`attendees/${cookie}`);\n        itemsRef.child('currentEvent').set('');\n        itemsRef.child(`pastEvents/${this.props.eventID}/`).set(this.props.eventID);\n        this.closedChild.current.handleOpen();\n    }\n\n    toggleShowInfo = (item) => {\n        const oldItems = this.state.items;\n        oldItems[item].showInfo = !oldItems[item].showInfo;\n        this.setState({\n            items: oldItems\n        });\n    }\n\n    isValidURL(str) {\n        const a = document.createElement('a');\n        a.href = str;\n        return (a.host && a.host !== window.location.host);\n    }\n\n    render() {\n        const SortableItem = SortableElement(({ value, item }) => (\n            <li className=\"rankings\" onClick={() => this.toggleShowInfo(item)}>\n                <div id='rankNumber'>{item + 1}</div>\n                <div id='rankTitle'>\n                    {value.name}\n                    {\n                        value.showInfo ?\n                            (\n                                <div id=\"expandedInfo\">\n                                    <b>By:</b> {value.presenters} <br />\n                                    <b>Attendance:</b> {value.entry_dates} <br />\n                                    {value.info_url && (\n                                        <>\n                                            <b>Info URL: </b>\n                                            {this.isValidURL(value.info_url) ? (\n                                                <a href={value.info_url}>{value.info_url}</a>\n                                            ) : value.info_url}\n                                        </>\n                                    )}\n                                </div>\n                            ) : ''\n                    }\n                </div>\n                <DragHandle id='rankHandle' />\n            </li>\n        ));\n\n        const SortableList = SortableContainer(({ items }) => {\n            return (\n                <ul>\n                    {items.length !== 0 ? <div /> : <div>Tap the Plus to add an entry</div>}\n                    {items.map((value, index) => (\n                        <SortableItem\n                            key={value.id}\n                            item={index}\n                            index={index}\n                            value={value}\n                        />\n                    ))}\n                </ul>\n            );\n        });\n\n        return (\n            <div>\n                <EventClosed handler={this.submitted} ref={this.closedChild} eventName={this.state.event.name} />\n                <SubmitConfirm handler={this.submitted} ref={this.confirmChild} items={this.state.items} eventID={this.state.event.id} />\n                <Typography variant=\"h4\" align=\"center\" className=\"eventName\" gutterBottom>{this.state.event.name}</Typography>\n                <div style={{ textAlign: 'center' }}>\n                    <AddCircleIcon className=\"AddEvent\" id=\"addEntry\" color=\"secondary\" onClick={this.handleAddEvent} />\n                </div>\n                <div>\n                    <div className=\"SortContainer\">\n                        <SortableList\n                            items={this.state.items}\n                            onSortEnd={this.onSortEnd}\n                            lockAxis=\"y\"\n                            useDragHandle\n                            helperClass=\"sortHelp\"\n                        />\n                    </div>\n                </div>\n\n                {(this.state.event.endVote !== 'none') ? (\n                    <div className=\"SubmitDiv\">\n                        <BellIcon className=\"BellIcon\" />\n                        <div className=\"SubmitText\">\n                            Voting will close in:\n                                <Countdown date={this.state.event.endVote} onFinished={this.countdownFinished} />\n                        </div>\n                        <div className=\"buttonDiv\">\n                            <Button variant=\"contained\" color=\"primary\" onClick={this.submitConfirm}> Submit </Button>\n                        </div>\n                    </div>\n                ) : (\n                        <div className=\"CenterSubmitDiv\">\n                            <div className=\"CenterButtonDiv\">\n                                <Button variant=\"contained\" color=\"primary\" onClick={this.submitConfirm}> Submit </Button>\n                            </div>\n                        </div>\n                    )}\n            </div>\n        );\n    }\n}\n"]},"metadata":{},"sourceType":"module"}