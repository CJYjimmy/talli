{"ast":null,"code":"import _classCallCheck from \"/Users/chenjiayuan/CS3312/talli/talli-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/chenjiayuan/CS3312/talli/talli-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/chenjiayuan/CS3312/talli/talli-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/chenjiayuan/CS3312/talli/talli-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/chenjiayuan/CS3312/talli/talli-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/chenjiayuan/CS3312/talli/talli-app/client/src/components/OrganizerView/AddEntryOrg.js\";\nimport React, { Component } from 'react';\nimport { Typography, Button, Divider } from '@material-ui/core';\nimport AddCircleIcon from '@material-ui/icons/AddCircle';\nimport NewEntryForm from './NewEntryForm';\nimport EntryImportInfo from './Dialogs/EntryImportInfo';\nimport '../component_style/Organizer.css';\nimport firebase from '../../firebase';\n/**\r\n * OrganizerView > AddEntryOrg\r\n * Allows organizers to add entries to their event\r\n * after setting up the event details (NewEventForm).\r\n */\n\nvar AddEntryOrg =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(AddEntryOrg, _Component);\n\n  function AddEntryOrg(props) {\n    var _this;\n\n    _classCallCheck(this, AddEntryOrg);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(AddEntryOrg).call(this, props));\n\n    _this.openInfo = function () {\n      _this.infoPopup.current.handleOpen();\n    };\n\n    _this.addEntry = function () {\n      var newEntries = _this.state.entries.slice();\n\n      newEntries.push({\n        show: true,\n        title: '',\n        id: '',\n        presenters: '',\n        entryDates: ''\n      });\n\n      _this.setState({\n        entries: newEntries,\n        alert: _this.state.alert\n      });\n    };\n\n    _this.cancelAddition = function () {\n      _this.props.handler(_this.props.orgViews.MAIN);\n    };\n\n    _this.readCSV = function (event) {\n      var f = event.target.files[0];\n\n      if (f) {\n        var r = new FileReader();\n        var a;\n\n        r.onload = function (e) {\n          var contents = r.result;\n          a = r.result;\n          var lines = contents.split(/[\\r\\n]+/g);\n          var tempEnt = [];\n          var line;\n          var lineTitle;\n          var linePres;\n          var lineDate;\n\n          for (var i = 1; i < lines.length; i++) {\n            line = lines[i].split(/,(?=(?:(?:[^\"]*\"){2})*[^\"]*$)/);\n\n            if (line.length !== 3 && line.length !== 0) {\n              a = 'File format is incorrect. Please see \"Import Requirements\" for correct formatting.';\n\n              _this.setState({\n                entries: _this.state.entries,\n                alert: a\n              });\n\n              return;\n            }\n\n            lineTitle = line[0];\n            linePres = line[1];\n            lineDate = line[2];\n\n            if (lineTitle && linePres && lineDate) {\n              tempEnt.push({\n                show: true,\n                title: lineTitle,\n                id: '',\n                presenters: linePres,\n                entryDates: lineDate\n              });\n            } else {\n              a = 'Some required data is missing. Please see \"Import Requirements\" for correct formatting.';\n\n              _this.setState({\n                entries: _this.state.entries,\n                alert: a\n              });\n\n              return;\n            }\n          } // concat entries here\n\n\n          a = \"Success! Entries from \".concat(f.name, \" were imported.\");\n\n          _this.setState({\n            entries: _this.state.entries.concat(tempEnt),\n            alert: a\n          });\n        };\n\n        r.readAsText(f);\n      } else {\n        _this.setState({\n          alert: 'Unable to read file.'\n        });\n      }\n    };\n\n    _this.state = {\n      entries: [],\n      alert: ''\n    };\n    _this.infoPopup = React.createRef();\n    return _this;\n  }\n\n  _createClass(AddEntryOrg, [{\n    key: \"updateEntry\",\n    value: function updateEntry(status, idx) {\n      var updateEntries = this.state.entries;\n      updateEntries[idx] = status;\n      this.setState({\n        entries: updateEntries,\n        alert: this.state.alert\n      });\n    }\n  }, {\n    key: \"submitEntries\",\n    value: function submitEntries() {\n      // DATABASE:\n      // add the entries with shown = true in this.state.entries\n      // to the current event\n      var googleId = this.props.user.googleId;\n      var eventID = this.props.curEvent;\n      var base = 1000 + Math.floor(Math.random() * 8000 + 1);\n\n      for (var i = 0; i < this.state.entries.length; i++) {\n        var item = this.state.entries[i];\n\n        if (item.show) {\n          item.id = base + i;\n          var itemsRef = firebase.database().ref(\"organizer/\".concat(googleId, \"/event/\").concat(eventID, \"/entries\"));\n          itemsRef.child(item.id).set(item);\n        }\n      }\n\n      this.props.handler(this.props.orgViews.MAIN);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var entries = this.state.entries;\n      return React.createElement(\"div\", {\n        className: \"addEntryForm\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 128\n        },\n        __self: this\n      }, React.createElement(EntryImportInfo, {\n        ref: this.infoPopup,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 129\n        },\n        __self: this\n      }), React.createElement(Typography, {\n        variant: \"h4\",\n        align: \"center\",\n        gutterBottom: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 130\n        },\n        __self: this\n      }, \"Add Entries\"), React.createElement(Button, {\n        variant: \"contained\",\n        component: \"label\",\n        className: \"buttons\",\n        name: \"import_entries\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 131\n        },\n        __self: this\n      }, \"Import Entries\", React.createElement(\"input\", {\n        type: \"file\",\n        accept: \".csv\",\n        style: {\n          display: 'none'\n        },\n        onChange: function onChange(e) {\n          return _this2.readCSV(e);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 133\n        },\n        __self: this\n      })), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135\n        },\n        __self: this\n      }), React.createElement(Typography, {\n        variant: \"subtitle1\",\n        align: \"center\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 136\n        },\n        __self: this\n      }, this.state.alert), React.createElement(Button, {\n        variant: \"text\",\n        className: \"buttons\",\n        onClick: this.openInfo,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137\n        },\n        __self: this\n      }, \"Click here for import requirements.\"), React.createElement(Divider, {\n        variant: \"middle\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 138\n        },\n        __self: this\n      }), React.createElement(\"form\", {\n        className: \"entryForm\",\n        onSubmit: function onSubmit() {\n          return _this2.submitEntries();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 139\n        },\n        __self: this\n      }, entries.map(function (val, idx) {\n        return React.createElement(\"div\", {\n          key: val.id,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 143\n          },\n          __self: this\n        }, React.createElement(NewEntryForm, {\n          currValue: val,\n          updateEntry: function updateEntry(status, index) {\n            return _this2.updateEntry(status, index);\n          },\n          index: idx,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 144\n          },\n          __self: this\n        }));\n      }), React.createElement(AddCircleIcon, {\n        color: \"primary\",\n        id: \"entryIcon\",\n        onClick: this.addEntry,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 153\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154\n        },\n        __self: this\n      }), React.createElement(Button, {\n        variant: \"contained\",\n        className: \"buttons\",\n        type: \"button\",\n        onClick: this.cancelAddition,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 155\n        },\n        __self: this\n      }, \"Cancel\"), React.createElement(Button, {\n        type: \"submit\",\n        variant: \"contained\",\n        color: \"primary\",\n        className: \"buttons\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 163\n        },\n        __self: this\n      }, \"Done\")));\n    }\n  }]);\n\n  return AddEntryOrg;\n}(Component);\n\nexport { AddEntryOrg as default };","map":{"version":3,"sources":["/Users/chenjiayuan/CS3312/talli/talli-app/client/src/components/OrganizerView/AddEntryOrg.js"],"names":["React","Component","Typography","Button","Divider","AddCircleIcon","NewEntryForm","EntryImportInfo","firebase","AddEntryOrg","props","openInfo","infoPopup","current","handleOpen","addEntry","newEntries","state","entries","slice","push","show","title","id","presenters","entryDates","setState","alert","cancelAddition","handler","orgViews","MAIN","readCSV","event","f","target","files","r","FileReader","a","onload","e","contents","result","lines","split","tempEnt","line","lineTitle","linePres","lineDate","i","length","name","concat","readAsText","createRef","status","idx","updateEntries","googleId","user","eventID","curEvent","base","Math","floor","random","item","itemsRef","database","ref","child","set","display","submitEntries","map","val","index","updateEntry"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { Typography, Button, Divider } from '@material-ui/core';\r\nimport AddCircleIcon from '@material-ui/icons/AddCircle';\r\nimport NewEntryForm from './NewEntryForm';\r\nimport EntryImportInfo from './Dialogs/EntryImportInfo';\r\nimport '../component_style/Organizer.css';\r\nimport firebase from '../../firebase';\r\n\r\n/**\r\n * OrganizerView > AddEntryOrg\r\n * Allows organizers to add entries to their event\r\n * after setting up the event details (NewEventForm).\r\n */\r\nexport default class AddEntryOrg extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            entries: [],\r\n            alert: ''\r\n        };\r\n        this.infoPopup = React.createRef();\r\n    }\r\n\r\n    openInfo = () => {\r\n        this.infoPopup.current.handleOpen();\r\n    }\r\n\r\n    addEntry = () => {\r\n        const newEntries = this.state.entries.slice();\r\n        newEntries.push({\r\n            show: true,\r\n            title: '',\r\n            id: '',\r\n            presenters: '',\r\n            entryDates: ''\r\n        });\r\n        this.setState({\r\n            entries: newEntries,\r\n            alert: this.state.alert\r\n        });\r\n    }\r\n\r\n    updateEntry(status, idx) {\r\n        const updateEntries = this.state.entries;\r\n        updateEntries[idx] = status;\r\n        this.setState({\r\n            entries: updateEntries,\r\n            alert: this.state.alert\r\n        });\r\n    }\r\n\r\n    cancelAddition = () => {\r\n        this.props.handler(this.props.orgViews.MAIN);\r\n    }\r\n\r\n    submitEntries() {\r\n        // DATABASE:\r\n        // add the entries with shown = true in this.state.entries\r\n        // to the current event\r\n        const googleId = this.props.user.googleId;\r\n        const eventID = this.props.curEvent;\r\n        const base = 1000 + Math.floor((Math.random() * 8000) + 1);\r\n        for (let i = 0; i < this.state.entries.length; i++) {\r\n            const item = this.state.entries[i];\r\n            if (item.show) {\r\n                item.id = base + i;\r\n                const itemsRef = firebase.database().ref(`organizer/${googleId}/event/${eventID}/entries`);\r\n                itemsRef.child(item.id).set(item);\r\n            }\r\n        }\r\n        this.props.handler(this.props.orgViews.MAIN);\r\n    }\r\n\r\n    readCSV = event => {\r\n        const f = event.target.files[0];\r\n        if (f) {\r\n            const r = new FileReader();\r\n            let a;\r\n            r.onload = (e) => {\r\n                const contents = r.result;\r\n                a = r.result;\r\n                const lines = contents.split(/[\\r\\n]+/g);\r\n                const tempEnt = [];\r\n                let line;\r\n                let lineTitle;\r\n                let linePres;\r\n                let lineDate;\r\n                for (let i = 1; i < lines.length; i++) {\r\n                    line = lines[i].split(/,(?=(?:(?:[^\"]*\"){2})*[^\"]*$)/);\r\n                    if (line.length !== 3 && line.length !== 0) {\r\n                        a = 'File format is incorrect. Please see \"Import Requirements\" for correct formatting.';\r\n                        this.setState({ entries: this.state.entries, alert: a });\r\n                        return;\r\n                    }\r\n                    lineTitle = line[0];\r\n                    linePres = line[1];\r\n                    lineDate = line[2];\r\n                    if (lineTitle && linePres && lineDate) {\r\n                        tempEnt.push({\r\n                            show: true,\r\n                            title: lineTitle,\r\n                            id: '',\r\n                            presenters: linePres,\r\n                            entryDates: lineDate,\r\n                        });\r\n                    } else {\r\n                        a = 'Some required data is missing. Please see \"Import Requirements\" for correct formatting.';\r\n                        this.setState({ entries: this.state.entries, alert: a });\r\n                        return;\r\n                    }\r\n                }\r\n                // concat entries here\r\n                a = `Success! Entries from ${f.name} were imported.`;\r\n                this.setState({\r\n                    entries: this.state.entries.concat(tempEnt),\r\n                    alert: a\r\n                });\r\n            };\r\n            r.readAsText(f);\r\n        } else {\r\n            this.setState({ alert: 'Unable to read file.' });\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const { entries } = this.state;\r\n        return (\r\n            <div className=\"addEntryForm\">\r\n                <EntryImportInfo ref={this.infoPopup} />\r\n                <Typography variant=\"h4\" align=\"center\" gutterBottom>Add Entries</Typography>\r\n                <Button variant=\"contained\" component=\"label\" className=\"buttons\" name=\"import_entries\">\r\n                    Import Entries\r\n                    <input type=\"file\" accept=\".csv\" style={{ display: 'none' }} onChange={e => this.readCSV(e)} />\r\n                </Button>\r\n                <br /><br />\r\n                <Typography variant=\"subtitle1\" align=\"center\">{this.state.alert}</Typography>\r\n                <Button variant=\"text\" className=\"buttons\" onClick={this.openInfo}>Click here for import requirements.</Button>\r\n                <Divider variant=\"middle\" />\r\n                <form className=\"entryForm\" onSubmit={() => this.submitEntries()}>\r\n                    {\r\n                        entries.map((val, idx) => {\r\n                            return (\r\n                                <div key={val.id}>\r\n                                    <NewEntryForm\r\n                                        currValue={val}\r\n                                        updateEntry={(status, index) => this.updateEntry(status, index)}\r\n                                        index={idx}\r\n                                    />\r\n                                </div>\r\n                            );\r\n                        })\r\n                    }\r\n                    <AddCircleIcon color=\"primary\" id=\"entryIcon\" onClick={this.addEntry} />\r\n                    <br />\r\n                    <Button\r\n                        variant=\"contained\"\r\n                        className=\"buttons\"\r\n                        type=\"button\"\r\n                        onClick={this.cancelAddition}\r\n                    >\r\n                        Cancel\r\n                    </Button>\r\n                    <Button type=\"submit\" variant=\"contained\" color=\"primary\" className=\"buttons\">Done</Button>\r\n                </form>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}